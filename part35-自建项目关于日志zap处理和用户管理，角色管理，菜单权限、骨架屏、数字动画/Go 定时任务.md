## 1: 安装依赖
```go
go get github.com/robfig/cron/v3@v3.0.0
```
## 2 : 定时任务HelloWorld

```go
package main
 
import (
    "fmt"
    "github.com/robfig/cron/v3"
    "time"
)
 
func main() {
    // 新建一个定时任务对象
    // 根据cron表达式进行时间调度，cron可以精确到秒，大部分表达式格式也是从秒开始。
    //crontab := cron.New()  默认从分开始进行时间调度
    crontab := cron.New(cron.WithSeconds()) //精确到秒
    //定义定时器调用的任务函数
    task := func() {
        fmt.Println("hello world", time.Now())
    }
    //定时任务
    spec := "*/5 * * * * ?" //cron表达式，每五秒一次
    // 添加定时任务,
    crontab.AddFunc(spec, task)
    // 启动定时器
    crontab.Start()
    // 定时任务是另起协程执行的,这里使用 select 简答阻塞.实际开发中需要
    // 根据实际情况进行控制
    select {} //阻塞主线程停止
}
------------------------------------------输出结果----------------------------------
hello world 2020-03-18 11:13:00.0241639 +0800 CST m=+3.113746301
hello world 2020-03-18 11:13:05.0007375 +0800 CST m=+8.090319901
hello world 2020-03-18 11:13:10.0004232 +0800 CST m=+13.090005601
hello world 2020-03-18 11:13:15.0003857 +0800 CST m=+18.089968101
hello world 2020-03-18 11:13:20.0003788 +0800 CST m=+23.089961201
```



<div id="content_views" class="htmledit_views">
                    <p>参考资料：&nbsp;<a class="link-info" href="https://github.com/robfig/cron" title="cron github仓库">cron github仓库</a></p> 
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<a class="link-info" href="https://godoc.org/github.com/robfig/cron" title="cron 官方说明文档">cron 官方说明文档</a></p> 
<h1><a name="t0"></a>1 安装依赖</h1> 
<pre data-index="0"><code class="language-bash hljs">go get github.com/robfig/cron/v3@v3.0.0</code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h1><a name="t1"></a>2 定时任务HelloWorld</h1> 
<pre data-index="1" class="set-code-hide" name="code"><code class="language-Go hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">package</span> main</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> (</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-string">"fmt"</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-string">"github.com/robfig/cron/v3"</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-string">"time"</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 新建一个定时任务对象</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 根据cron表达式进行时间调度，cron可以精确到秒，大部分表达式格式也是从秒开始。</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">//crontab := cron.New() &nbsp;默认从分开始进行时间调度</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;crontab := cron.New(cron.WithSeconds()) <span class="hljs-comment">//精确到秒</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">//定义定时器调用的任务函数</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;task := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fmt.Println(<span class="hljs-string">"hello world"</span>, time.Now())</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">//定时任务</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;spec := <span class="hljs-string">"*/5 * * * * ?"</span> <span class="hljs-comment">//cron表达式，每五秒一次</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 添加定时任务,</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;crontab.AddFunc(spec, task)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 启动定时器</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;crontab.Start()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 定时任务是另起协程执行的,这里使用 select 简答阻塞.实际开发中需要</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 根据实际情况进行控制</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-keyword">select</span> {} <span class="hljs-comment">//阻塞主线程停止</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">------------------------------------------输出结果----------------------------------</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">hello world <span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">13</span>:<span class="hljs-number">00.0241639</span> +<span class="hljs-number">0800</span> CST m=+<span class="hljs-number">3.113746301</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">hello world <span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">13</span>:<span class="hljs-number">05.0007375</span> +<span class="hljs-number">0800</span> CST m=+<span class="hljs-number">8.090319901</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">hello world <span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">13</span>:<span class="hljs-number">10.0004232</span> +<span class="hljs-number">0800</span> CST m=+<span class="hljs-number">13.090005601</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">hello world <span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">13</span>:<span class="hljs-number">15.0003857</span> +<span class="hljs-number">0800</span> CST m=+<span class="hljs-number">18.089968101</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">hello world <span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-18</span> <span class="hljs-number">11</span>:<span class="hljs-number">13</span>:<span class="hljs-number">20.0003788</span> +<span class="hljs-number">0800</span> CST m=+<span class="hljs-number">23.089961201</span></div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h1><a name="t2"></a>3 Cron 表达式</h1> 
<p>cron表达式是一个好东西，这个东西不仅Java的quartZ能用到，Go语言中也可以用到。我没有用过Linux的cron，但网上说Linux也是可以用crontab -e命令来配置定时任务。Go语言和Java中都是可以精确到秒的，但是Linux中不行。cron表达式代表一个时间的集合，使用6个空格分隔的字段表示：</p> 
<div class="table-box"><table align="center" border="1" cellpadding="1" cellspacing="1"><tbody><tr><td style="text-align:center;vertical-align:middle;">字段名</td><td style="text-align:center;vertical-align:middle;">是否必须</td><td style="text-align:center;vertical-align:middle;">允许的值</td><td style="text-align:center;vertical-align:middle;">允许的特定字符</td></tr><tr><td style="text-align:center;vertical-align:middle;">秒(Seconds)</td><td style="text-align:center;vertical-align:middle;">是</td><td style="text-align:center;vertical-align:middle;">0-59</td><td style="text-align:center;vertical-align:middle;">* / , -</td></tr><tr><td style="text-align:center;vertical-align:middle;">分(Minute)</td><td style="text-align:center;vertical-align:middle;">是</td><td style="text-align:center;vertical-align:middle;">0-59</td><td style="text-align:center;vertical-align:middle;">* / , -</td></tr><tr><td style="text-align:center;vertical-align:middle;">时(Hours)</td><td style="text-align:center;vertical-align:middle;">是</td><td style="text-align:center;vertical-align:middle;">0-23</td><td style="text-align:center;vertical-align:middle;">* / , -</td></tr><tr><td style="text-align:center;vertical-align:middle;">日(Day of month)</td><td style="text-align:center;vertical-align:middle;">是</td><td style="text-align:center;vertical-align:middle;">1-31</td><td style="text-align:center;vertical-align:middle;">* / , - ?</td></tr><tr><td style="text-align:center;vertical-align:middle;">月(Month)&nbsp;</td><td style="text-align:center;vertical-align:middle;">是</td><td style="text-align:center;vertical-align:middle;">1-12 或 JAN-DEC</td><td style="text-align:center;vertical-align:middle;">* / , -</td></tr><tr><td style="text-align:center;vertical-align:middle;">星期(Day of week)&nbsp;</td><td style="text-align:center;vertical-align:middle;">否</td><td style="text-align:center;vertical-align:middle;">0-6 或 SUM-SAT&nbsp;</td><td style="text-align:center;vertical-align:middle;">* / , - ?</td></tr></tbody></table></div> 
<h2><a name="t3"></a>3.1 Cron表达式说明</h2> 
<ul><li>月(Month)和星期(Day of week)字段的值不区分大小写，如：SUN、Sun 和 sun 是一样的。</li><li>星期(Day of week)字段如果没提供，相当于是 *</li></ul> 
<h2><a name="t4"></a>3.2 Cron表达式示例说明</h2> 
<ul><li>如果我们使用 crontab := cron.New(cron.WithSeconds()),</li><li>比如我们传递了一个字符串是："* * * * * *"在crontab.AddFunc()的第一个参数，这六个*是指什么呢？</li><li>如果是用crontab := cron.New() 则只需要五个*,如* * * * *</li></ul> 
<pre data-index="2"><code class="language-bash hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;┌─────────────second 范围 (0 - 60)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;│ ┌───────────── min (0 - 59)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;│ │ ┌────────────── hour (0 - 23)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;│ │ │ ┌─────────────── day of month (1 - 31)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;│ │ │ │ ┌──────────────── month (1 - 12)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;│ │ │ │ │ ┌───────────────── day of week (0 - 6) (0 to 6 are Sunday to</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;│ │ │ │ │ │ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Saturday)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;│ │ │ │ │ │</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;│ │ │ │ │ │</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;* * * * * *</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h2><a name="t5"></a>3.3 cron特定字符说明</h2> 
<div class="table-box"><table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td style="text-align:center;vertical-align:middle;width:78px;">符号</td><td style="text-align:center;vertical-align:middle;width:610px;">说明</td></tr><tr><td style="text-align:center;vertical-align:middle;width:78px;">(*)</td><td style="text-align:left;vertical-align:middle;width:610px;">表示 cron 表达式能匹配该字段的所有值。如在第5个字段使用星号(month)，表示每个月</td></tr><tr><td style="text-align:center;vertical-align:middle;width:78px;">(/)</td><td style="text-align:left;vertical-align:middle;width:610px;">表示增长间隔，如第1个字段(minutes) 值是 3-59/15，表示每小时的第3分钟开始执行一次，之后每隔 15 分钟执行一次（即 3、18、33、48 这些时间点执行），这里也可以表示为：3/15</td></tr><tr><td style="text-align:center;vertical-align:middle;width:78px;">(,)</td><td style="text-align:left;vertical-align:middle;width:610px;">用于枚举值，如第6个字段值是 MON,WED,FRI，表示 星期一、三、五 执行</td></tr><tr><td style="text-align:center;vertical-align:middle;width:78px;">(-)</td><td style="text-align:left;vertical-align:middle;width:610px;">表示一个范围，如第3个字段的值为 9-17 表示 9am 到 5pm 直接每个小时（包括9和17）</td></tr><tr><td style="text-align:center;vertical-align:middle;width:78px;">(?)</td><td style="text-align:left;vertical-align:middle;width:610px;">只用于 日(Day of month) 和 星期(Day of week)，表示不指定值，可以用于代替 *</td></tr></tbody></table></div> 
<h2><a name="t6"></a>3.4 常用cron举例</h2> 
<pre data-index="3" class="set-code-hide" name="code"><code class="language-bash hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">每隔5秒执行一次：*/5 * * * * ?</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">每隔1分钟执行一次：0 */1 * * * ?</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">每天23点执行一次：0 0 23 * * ?</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">每天凌晨1点执行一次：0 0 1 * * ?</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">每月1号凌晨1点执行一次：0 0 1 1 * ?</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">每周一和周三晚上22:30: 00 30 22 * * 1,3&nbsp;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">在26分、29分、33分执行一次：0 26,29,33 * * * ?</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">每天的0点、13点、18点、21点都执行一次：0 0 0,13,18,21 * * ?</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">每年三月的星期四的下午14:10和14:40: &nbsp;00 10,40 14 ? 3 4&nbsp;</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h2><a name="t7"></a>3.5 预定义的时间格式</h2> 
<p>您可以使用几个预定义的表达式来代替上表的表达式,使用如下:</p> 
<div class="table-box"><table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td style="text-align:center;vertical-align:middle;">输入</td><td style="text-align:center;vertical-align:middle;">描述</td><td style="text-align:center;vertical-align:middle;">等式</td></tr><tr><td style="text-align:center;vertical-align:middle;">@yearly (or @annually)</td><td style="text-align:center;vertical-align:middle;">每年1月1日午夜跑步一次</td><td style="text-align:center;vertical-align:middle;">0 0 0 1 1 *</td></tr><tr><td style="text-align:center;vertical-align:middle;">@monthly</td><td style="text-align:center;vertical-align:middle;">每个月第一天的午夜跑一次</td><td style="text-align:center;vertical-align:middle;">0 0 0 1 * *</td></tr><tr><td style="text-align:center;vertical-align:middle;">@weekly</td><td style="text-align:center;vertical-align:middle;">每周周六的午夜运行一次</td><td style="text-align:center;vertical-align:middle;">0 0 0 * * 0</td></tr><tr><td style="text-align:center;vertical-align:middle;">@daily (or @midnight)</td><td style="text-align:center;vertical-align:middle;">每天午夜跑一次</td><td style="text-align:center;vertical-align:middle;">0 0 0 * * *</td></tr><tr><td style="text-align:center;vertical-align:middle;">@hourly</td><td style="text-align:center;vertical-align:middle;">每小时运行一次</td><td style="text-align:center;vertical-align:middle;">0 0 * * * *</td></tr><tr><td style="text-align:center;vertical-align:middle;">@every &lt;duration&gt;</td><td style="text-align:center;vertical-align:middle;">every duration</td><td style="text-align:center;vertical-align:middle;"></td></tr></tbody></table></div> 
<pre data-index="4"><code class="language-bash hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">c := cron.New()&nbsp;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">c.AddFunc(<span class="hljs-string">"@every 1h30m"</span>, <span class="hljs-function"><span class="hljs-title">func</span></span>() { fmt.Println(<span class="hljs-string">"Every hour thirty"</span>) })</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h1><a name="t8"></a>4 多个定时任务</h1> 
<pre data-index="5" class="set-code-hide" name="code"><code class="language-Go hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">package</span> main</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> (</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-string">"fmt"</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-string">"github.com/robfig/cron/v3"</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-string">"time"</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">type</span> TestTask <span class="hljs-keyword">struct</span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;Name <span class="hljs-type">string</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *TestTask)</span></span> Run() {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;fmt.Println(<span class="hljs-string">"TestTask"</span>, t.Name)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">type</span> Test2Task <span class="hljs-keyword">struct</span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;Name <span class="hljs-type">string</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *Test2Task)</span></span> Run() {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;fmt.Println(<span class="hljs-string">"Test2Task"</span>, t.Name)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 新建一个定时任务对象</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 根据cron表达式进行时间调度，cron可以精确到秒，大部分表达式格式也是从秒开始。</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">//crontab := cron.New() &nbsp;默认从分开始进行时间调度</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;crontab := cron.New(cron.WithSeconds()) <span class="hljs-comment">//精确到秒</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">//定义定时器调用的任务函数</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">//定时任务</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;spec := <span class="hljs-string">"*/5 * * * * ?"</span> <span class="hljs-comment">//cron表达式，每五秒一次</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">//定义定时器调用的任务函数</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;task := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fmt.Println(<span class="hljs-string">"hello world"</span>, time.Now())</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 添加定时任务</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;crontab.AddFunc(spec, task)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 添加多个定时器</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;crontab.AddJob(spec, &amp;TestTask{Name: <span class="hljs-string">"tom"</span>})</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;crontab.AddJob(spec, &amp;Test2Task{Name: <span class="hljs-string">"jeck"</span>})</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 启动定时器</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;crontab.Start()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">//关闭着计划任务, 但是不能关闭已经在执行中的任务.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-keyword">defer</span> crontab.Stop()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 定时任务是另起协程执行的,这里使用 select 简答阻塞.实际开发中需要</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-comment">// 根据实际情况进行控制</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp; &nbsp;<span class="hljs-keyword">select</span> {} <span class="hljs-comment">//阻塞主线程停止</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">--------------------------------------输出结果----------------------------------------</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">TestTask tom</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Test2Task jeck</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">hello world <span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-18</span> <span class="hljs-number">13</span>:<span class="hljs-number">22</span>:<span class="hljs-number">10.0245997</span> +<span class="hljs-number">0800</span> CST m=+<span class="hljs-number">2.761856801</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">TestTask tom</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Test2Task jeck</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">hello world <span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-18</span> <span class="hljs-number">13</span>:<span class="hljs-number">22</span>:<span class="hljs-number">15.0008245</span> +<span class="hljs-number">0800</span> CST m=+<span class="hljs-number">7.738081601</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="59"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">……………………………………</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h1><a name="t9"></a>5 主要类型或接口说明</h1> 
<h2><a name="t10"></a>5.1 Cron</h2> 
<p>Cron：包含一系列要执行的实体；支持暂停【stop】；添加实体等</p> 
<p><strong>注意：</strong></p> 
<ul><li>Cron 结构没有导出任何成员。</li><li>有一个成员stop，类型是struct{}，即空结构体。</li></ul> 
<pre data-index="6"><code class="language-Go hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">type</span> Cron <span class="hljs-keyword">struct</span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; entries &nbsp;[]*Entry</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; stop &nbsp; &nbsp; <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{} &nbsp; <span class="hljs-comment">// 控制 Cron 实例暂停</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; add &nbsp; &nbsp; &nbsp;<span class="hljs-keyword">chan</span> *Entry &nbsp; &nbsp; <span class="hljs-comment">// 当 Cron 已经运行了，增加新的 Entity 是通过 add 这个 channel 实现的</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; snapshot <span class="hljs-keyword">chan</span> []*Entry &nbsp; <span class="hljs-comment">// 获取当前所有 entity 的快照</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; running &nbsp;<span class="hljs-type">bool</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-comment">// 当已经运行时为true；否则为false</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h2><a name="t11"></a>5.2 Entry调度实体</h2> 
<pre data-index="7" class="set-code-hide" name="code"><code class="language-Go hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">type</span> Entry <span class="hljs-keyword">struct</span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// The schedule on which this job should be run.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// 负责调度当前 Entity 中的 Job 执行</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; Schedule Schedule</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// The next time the job will run. This is the zero time if Cron has not been</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// started or this entry's schedule is unsatisfiable</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// Job 下一次执行的时间</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; Next time.Time</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// The last time this job was run. This is the zero time if the job has never</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// been run.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// 上一次执行时间</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; Prev time.Time</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// The Job to run.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// 要执行的 Job</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; Job Job</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h2><a name="t12"></a>5.3 Job</h2> 
<p>Job：每一个实体包含一个需要运行的Job,这是一个接口，只有一个方法：<span style="color:#fe2c24;"><strong>Run</strong></span></p> 
<pre data-index="8"><code class="language-Go hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">type</span> Job <span class="hljs-keyword">interface</span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; Run()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p>由于 Entity 中需要 Job 类型，因此，我们希望定期运行的任务，就需要实现 Job 接口。同时，由于 Job 接口只有一个无参数无返回值的方法，为了使用方便，作者提供了一个类型</p> 
<pre data-index="9"><code class="language-Go hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">type</span> FuncJob <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">它通过简单的实现 Run() 方法来实现 Job 接口：</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f FuncJob)</span></span> Run() { f() }</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">这样，任何无参数无返回值的函数，通过强制类型转换为 FuncJob，就可以当作 Job 来使用了，AddFunc 方法 就是这么做的。</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h2><a name="t13"></a>5.4 Schedule</h2> 
<p>每个实体包含一个调度器（Schedule）负责调度 Job 的执行。它也是一个接口。Schedule 的具体实现通过解析 Cron 表达式得到。库中提供了 Schedule 的两个具体实现，分别是 SpecSchedule 和 ConstantDelaySchedule。</p> 
<pre data-index="10"><code class="language-Go hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">type</span> Schedule <span class="hljs-keyword">interface</span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// Return the next activation time, later than the given time.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// Next is invoked initially, and then each time the job is run.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-comment">// 返回同一 Entity 中的 Job 下一次执行的时间</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; Next(time.Time) time.Time</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h3><a name="t14"></a>5.4.1 SpecSchedule</h3> 
<p>从开始介绍的 Cron 表达式可以容易得知各个字段的意思，同时，对各种表达式的解析也会最终得到一个 SpecSchedule 的实例。库中的 Parse 返回的其实就是 SpecSchedule 的实例（当然也就实现了 Schedule 接口）</p> 
<pre data-index="11"><code class="language-Go hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">type</span> SpecSchedule <span class="hljs-keyword">struct</span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; Second, Minute, Hour, Dom, Month, Dow <span class="hljs-type">uint64</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h3><a name="t15"></a>5.4.2 ConstantDelaySchedule</h3> 
<pre data-index="12"><code class="language-Go hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">type</span> ConstantDelaySchedule <span class="hljs-keyword">struct</span> {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; Delay time.Duration <span class="hljs-comment">// 循环的时间间隔</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p>这是一个简单的循环调度器，如：每 5 分钟。注意，最小单位是秒，不能比秒还小，比如 毫秒。</p> 
<p>通过 Every 函数可以获取该类型的实例，如下得到的是一个每 5 秒执行一次的调度器。：</p> 
<pre data-index="13"><code class="language-Go hljs">constDelaySchedule := Every(<span class="hljs-number">5e9</span>)</code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h1><a name="t16"></a>6 函数调用</h1> 
<h2><a name="t17"></a>6.1 实例化 Cron</h2> 
<p>实例化时，成员使用的基本是默认值；</p> 
<pre data-index="14"><code class="language-Go hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">()</span></span> *Cron {</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; <span class="hljs-keyword">return</span> &amp;Cron{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; &nbsp; &nbsp; entries: &nbsp;<span class="hljs-literal">nil</span>,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; &nbsp; &nbsp; add: &nbsp; &nbsp; &nbsp;<span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> *Entry),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; &nbsp; &nbsp; stop: &nbsp; &nbsp; <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{}),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; &nbsp; &nbsp; snapshot: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> []*Entry),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; &nbsp; &nbsp; running: &nbsp;<span class="hljs-literal">false</span>,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp; &nbsp; }</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h2><a name="t18"></a>6.2 成员方法</h2> 
<p>如果对每个方法调用还是不了解可以去看一下每个函数的实现源码</p> 
<pre data-index="15" class="set-code-hide" name="code"><code class="language-Go hljs"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// EntryID identifies an entry within a Cron instance</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">type</span> EntryID <span class="hljs-type">int</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 将 job 加入 Cron 中</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 如上所述，该方法只是简单的通过 FuncJob 类型强制转换 cmd，然后调用 AddJob 方法</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Cron)</span></span> AddFunc(spec <span class="hljs-type">string</span>, cmd <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>) (EntryID, <span class="hljs-type">error</span>)&nbsp;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 将 job 加入 Cron 中</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 通过 Parse 函数解析 cron 表达式 spec 的到调度器实例(Schedule)，之后调用 c.Schedule 方法</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Cron)</span></span> AddJob(spec <span class="hljs-type">string</span>, cmd Job) (EntryID, <span class="hljs-type">error</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 获取当前 Cron 总所有 Entities 的快照</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Cron)</span></span> Entries() []*Entry</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// Location获取时区位置</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Cron)</span></span> Location() *time.Location&nbsp;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// Entry返回给定项的快照，如果找不到则返回nil</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Cron)</span></span> Entry(id EntryID) Entry</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 删除将来运行的条目。</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Cron)</span></span> Remove(id EntryID)&nbsp;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 通过两个参数实例化一个 Entity，然后加入当前 Cron 中</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 注意：如果当前 Cron 未运行，则直接将该 entity 加入 Cron 中；</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 否则，通过 add 这个成员 channel 将 entity 加入正在运行的 Cron 中</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Cron)</span></span> Schedule(schedule Schedule, cmd Job) EntryID</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 新启动一个 goroutine 运行当前 Cron</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Cron)</span></span> Start()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 通过给 stop 成员发送一个 struct{}{} 来停止当前 Cron，同时将 running 置为 false</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 从这里知道，stop 只是通知 Cron 停止，因此往 channel 发一个值即可，而不关心值是多少</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 所以，成员 stop 定义为空 struct</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Cron)</span></span> Stop()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// 运行cron调度程序，如果已经在运行，则不运行op</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Cron)</span></span> Run()</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p></p>
</div>

