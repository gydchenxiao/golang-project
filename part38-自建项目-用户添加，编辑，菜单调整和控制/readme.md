## 授予用户角色

- 把roleids全部拿到
- 并且拿到用户的id
- 然后调用授予角色的接口
  - 根据用户id删除对应角色
  - 然后把新角色全部重新保存进sys_user_roles

```
var users = []User{{Name: "jinzhu1"}, {Name: "jinzhu2"}, {Name: "jinzhu3"}}
db.Create(&users)

var sysUserRoles =  []SysUserRoles{{UserId: 1,RoleId:1},{UserId: 1,RoleId:2},{UserId: 1,RoleId:3}}
db.Create(&users)
```





# 13、事务的简单认识

对于要把事务在实际中使用好，需要了解事务的特性。

事务的四大特性主要是：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）。

**一、事务的四大特性**

**1.1** **原子性（Atomicity）**

原子性是指事务是一个不可分割的工作单位，事务中的操作要么全部成功，要么全部失败。比如在同一个事务中的SQL语句，要么全部执行成功，要么全部执行失败。



```mysql
begin transaction;
    update account set money = money-100 where name = '张三';
    update account set money = money+100 where name = '李四';
commit transaction;
```

**1.2** **一致性（Consistency）**

官网上事务一致性的概念是：事务必须使数据库从一个一致性状态变换到另外一个一致性状态。

换一种方式理解就是：事务按照预期生效，数据的状态是预期的状态。

举例说明：张三向李四转100元，转账前和转账后的数据是正确的状态，这就叫一致性，如果出现张三转出100元，李四账号没有增加100元这就出现了数据错误，就没有达到一致性。

**1.3** **隔离性（Isolation）**

事务的隔离性是多个用户并发访问数据库时，数据库为每一个用户开启的事务，不能被其他事务的操作数据所干扰，多个并发事务之间要相互隔离。

**1.4** **持久性（Durability）**

持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响。

例如我们在使用JDBC操作数据库时，在提交事务方法后，提示用户事务操作完成，当我们程序执行完成直到看到提示后，就可以认定事务以及正确提交，即使这时候数据库出现了问题，也必须要将我们的事务完全执行完成，否则就会造成我们看到提示事务处理完毕，但是数据库因为故障而没有执行事务的重大错误。



## 什么情况下会用到事务呢？

在开发中如果，牵涉到业务执行方法，处理的写入（insert.update,delete）的时候，如果存在多种写入，你要保证他们执行顺序和整体性你就必须靠事务。因为事务可以把这些写入指令全部放入到一个事务队列中，来进行操作。然后在操作的过程中，如果写入这些sql语言，会执行sql语句指令，但是不并不会马上写入到磁盘数据中。暂时只会全部在内存进行记录和处理。只有触发到commit指令的时候，全会进行比对然后开始写入到数据库表中，如果遇到的rollback就会之前执行的sql全部回滚掉不去持久化数据库表中。